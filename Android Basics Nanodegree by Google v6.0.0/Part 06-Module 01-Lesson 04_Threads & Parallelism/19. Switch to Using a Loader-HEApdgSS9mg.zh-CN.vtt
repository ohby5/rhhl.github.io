WEBVTT
Kind: captions
Language: zh-CN

00:00:00.220 --> 00:00:03.620
你已经了解了 加载器和代码示例背后的理念

00:00:03.620 --> 00:00:08.472
所以 你现在已经准备好开始练习 在 Quake Report 应用中

00:00:08.472 --> 00:00:10.209
独立实施加载器了

00:00:10.209 --> 00:00:14.134
你的应用已经成功在 Internet 上 获取了地震数据

00:00:14.134 --> 00:00:17.404
因此在这个任务中 你需要重构应用

00:00:17.404 --> 00:00:19.092
使其使用 AsyncTask 加载器而不是 AsyncTask

00:00:19.092 --> 00:00:23.013
代码重构意味着 从实现细节上更改

00:00:23.013 --> 00:00:26.820
代码的结构 同时保持相同的外部行为

00:00:26.820 --> 00:00:27.830
UI 的外观和行为保持不变

00:00:27.830 --> 00:00:31.550
所以应用的最终用户 不会注意到区别

00:00:31.550 --> 00:00:35.405
但重构之后 由于加载器可以更好地

00:00:35.405 --> 00:00:38.373
处理设备循环和活动周期 内存使用效率会更高

00:00:38.373 --> 00:00:42.050
要将 AsyncTask 换成 AsyncTaskLoader 需要做

00:00:42.050 --> 00:00:43.900
三件事

00:00:43.900 --> 00:00:47.910
首先 我们需要编写一个 AsyncTaskLoader 的子类

00:00:47.910 --> 00:00:50.790
将其命名为 EarthquakeLoader 类

00:00:50.790 --> 00:00:53.590
最重要的方法是 LoadInBackground

00:00:53.590 --> 00:00:56.760
该方法与 AsyncTask 的 DoInBackground 原理相同

00:00:56.760 --> 00:00:59.950
其次 我们需要做一些工作 使 EarthquakeActivity

00:00:59.950 --> 00:01:01.350
使用我们的加载器

00:01:01.350 --> 00:01:04.510
因此我们需要实现 LoaderCallbacks 接口

00:01:04.510 --> 00:01:08.600
这样 LoaderManager 就可以 通知我们创建加载器

00:01:08.600 --> 00:01:11.220
或者在加载器有了结果时 发出通知

00:01:11.220 --> 00:01:14.740
最后 在创建 EarthquakeActivity 后 应该使加载器管理器

00:01:14.740 --> 00:01:19.570
初始化新的地震加载器 或者重用现有的地震加载器

00:01:19.570 --> 00:01:21.870
还可以用另一种方式 考虑代码重构

00:01:21.870 --> 00:01:24.555
本质上你想要将 AsyncTask 的

00:01:24.555 --> 00:01:29.950
DoInBackground 方法中的代码转移到 加载器的 LoadInBackground 方法中

00:01:29.950 --> 00:01:33.220
对于 AsyncTask 的 onPostExecute 方法

00:01:33.220 --> 00:01:37.174
代码应当转移到 地震活动的 onLoadFinished 方法中

00:01:37.174 --> 00:01:39.690
这是因为 该方法在主线程上运行

00:01:39.690 --> 00:01:43.720
在该方法中 我们从加载器获取结果并更新 UI

00:01:43.720 --> 00:01:46.710
此外 你还可以在 测验下边的注释中

00:01:46.710 --> 00:01:48.760
获取部分代码的要点 以帮助你开始

00:01:48.760 --> 00:01:53.320
注释中不包含正式 Java 文件的 全部详细信息 如包名或 import 语句

00:01:53.320 --> 00:01:56.060
但希望为你 指明正确方向

00:01:56.060 --> 00:01:59.680
做完这三步后 请选中这里的复选框以继续

