WEBVTT
Kind: captions
Language: ar

00:00:00.533 --> 00:00:03.566
جهز نفسك لفيديو إجابة طويل نوعاً ما.

00:00:03.857 --> 00:00:05.714
ولكننا سنعالجه خطوة تلو الأخرى

00:00:06.103 --> 00:00:08.500
إذاً في البداية نريد أن نطلب تركيز الصوت

00:00:08.751 --> 00:00:11.818
وهذا يعني أننا نريد نسخة
من كائن (مدير الصوت)

00:00:12.500 --> 00:00:14.200
الآن، وفي NumbersActivity..

00:00:14.432 --> 00:00:19.511
سأنشئ متغيراً عاماً لأبدأه مرة
واحدة خلال كامل حياة النشاط

00:00:19.933 --> 00:00:22.393
بعدها، وفي وظيفة onCreate
في NumbersActivity

00:00:22.544 --> 00:00:25.813
سأبدأ مدير الصوت عبر استدعاء
getSystemService

00:00:25.973 --> 00:00:27.980
وأمرر لها الثابت
خدمة AudioManager

00:00:28.333 --> 00:00:30.566
السبب في معرفتي لكتابة هذا السطر..

00:00:30.733 --> 00:00:33.061
هو أني رأيت في درس مشغل الوسائط هذا..

00:00:33.167 --> 00:00:36.733
كيف يشير إلى خدمة النظام (مدير الصوت)

00:00:37.204 --> 00:00:39.032
وما أن نحصل على كائن (مدير الصوت)..

00:00:39.072 --> 00:00:41.683
يمكننا استدعاء وظيفة
(طلب تركيز الصوت) عليه

00:00:41.866 --> 00:00:44.810
لذا دعنا ننسخ هذا المقتطف من الكود
ونضيفه إلى تطبيقنا

00:00:47.193 --> 00:00:49.926
الآن، أين المكان المناسب
لطلب تركيز الصوت؟

00:00:50.276 --> 00:00:52.032
أعرف أنه عند النقر على عنصر..

00:00:52.119 --> 00:00:54.995
فأنا أريد استخدام مدير الصوت
لطلب تركيز الصوت هناك

00:00:55.035 --> 00:00:57.235
وقبل ضبط مشغل الوسائط ليشغل الصوت

00:00:57.347 --> 00:00:58.879
لذا سألصق الكود هنا

00:00:59.067 --> 00:01:03.267
بعد حصولنا على كود كائن (الكلمة)
وبعد (إطلاق مشغل الوسائط)

00:01:04.871 --> 00:01:07.149
أريد أن أزيد وضوح أسماء المتغيرات

00:01:07.237 --> 00:01:11.641
لذا سأغير اسم المتغير الحالي من am
إلى mAudioManager

00:01:11.812 --> 00:01:15.272
الآن وعندما نطلب (تركيز الصوت)،
سأمرر له 3 مدخلات

00:01:15.467 --> 00:01:16.800
سأمرر مستمع Listener

00:01:17.054 --> 00:01:19.144
وأحدد نوع تدفق الموسيقى
stream type

00:01:19.446 --> 00:01:21.914
ولكم من الوقت سنطلب الصوت.

00:01:22.695 --> 00:01:26.162
في الكود المثال الذي نسخناه
طلب AUDIOFOCUS_GAIN

00:01:26.500 --> 00:01:30.233
وذلك لطلب تركيز الصوت لفترة طويلة
غير محددة المدة

00:01:30.500 --> 00:01:32.233
كما في تشغيل أغنية موسيقية

00:01:32.667 --> 00:01:36.214
على أية حال، فإن مدة ملفاتنا
الصوتية ثانية أو اثنتين فقط

00:01:36.357 --> 00:01:38.859
لذا فإننا نحتاج تركيز الصوت
لفترة قصيرة فقط.

00:01:39.328 --> 00:01:43.500
وعليه فسنغير AUDIOFOCUS_GAIN
إلى AUDIOFOCUS_GAIN_TRANSIENT

00:01:44.591 --> 00:01:46.658
والآن يبدو أننا نواجه خطأين هنا

00:01:46.845 --> 00:01:51.245
وذلك لأن (آندرويد استوديو) لم يتفهم
تعريف المستمع Listener

00:01:51.424 --> 00:01:53.291
وهذا لأننا لم نعرف مستمع بعد

00:01:53.514 --> 00:01:55.214
ولكننا سنعود لإصلاحه لاحقاً

00:01:55.400 --> 00:01:59.471
وإذا عدنا للدرس التعليمي، وتفحصنا
المزيد من وظيفة (طلب تركيز الصوت)..

00:01:59.817 --> 00:02:02.255
فسنرى أن هذه الوظيفة تجيب بعدد طبيعي

00:02:02.605 --> 00:02:05.504
وخمن ماذا؟ فإن الإجابة أيضاً قيمة ثابتة

00:02:05.800 --> 00:02:08.133
في الأسفل هنا في توثيقات الوظيفة..

00:02:08.200 --> 00:02:12.867
توضح الإجابتين المتاحتين هما
AudioFocus_Request_Failed..

00:02:13.057 --> 00:02:15.290
أو AudioFocus_Request_Granted

00:02:15.506 --> 00:02:18.894
كل من هذين الثابتين
هو متغير نهائي ثابت

00:02:19.136 --> 00:02:21.548
ولكل منهما يساوي قيمة عددية ثابتة

00:02:21.909 --> 00:02:23.712
والآن إذا عدنا إلى عينة الكود..

00:02:23.919 --> 00:02:27.445
إذا كانت النتيجة تساوي
AudioFocus_Request_Granted..

00:02:27.882 --> 00:02:32.115
فقد حصلنا على تركيز الصوت بنجاح
ويمكننا تشغيل الصوت في تطبيقنا

00:02:32.652 --> 00:02:37.231
بالعودة إلى كودنا، فقد أضفنا جملة if
أسفل مقطع طلب تركيز الصوت

00:02:37.385 --> 00:02:41.293
ما أن نحصل على تركيز الصوت..
فإننا نريد إنشاء وبدء مشغل الوسائط

00:02:41.531 --> 00:02:43.265
ثم نُعد مستمع الإكمال

00:02:43.496 --> 00:02:46.908
لذا فمقطع الكود هذا يحتاج
لأن يدخل ضمن جملة if

00:02:47.292 --> 00:02:48.990
لذا سأنقل قوس الإغلاق هذا

00:02:50.359 --> 00:02:51.359
انتهينا هنا

00:02:52.005 --> 00:02:54.354
لذا سأعدل هذا التعليق، وسأقول..

00:02:54.473 --> 00:02:56.508
حصلنا على تركيز الصوت الآن

00:02:56.979 --> 00:03:00.375
ثم سأزيد المسافة البادئة لهذه
السطور لأنها ضمن جملة if

00:03:00.868 --> 00:03:04.536
فإذا لم نحصل على تركيز الصوت،
فلا حاجة لنا لبدء مشغل الوسائط

00:03:04.636 --> 00:03:06.595
سيتعين على المستخدم نقر العنصر مجدداً..

00:03:06.666 --> 00:03:09.232
ولنأمل عندها أن نحصل على تركيز الصوت

00:03:09.533 --> 00:03:12.792
هكذا فرغنا من المهمة الأولى..
طلب تركيز الصوت

00:03:13.000 --> 00:03:17.248
الآن لنركز على تطبيق..
OnAudioFocusChangeListener

00:03:17.553 --> 00:03:20.086
وهو ما سيساعدنا على التخلص
من الخطأ في الكود

00:03:20.586 --> 00:03:22.237
لنكتشف كيف سيبدو المستمع

00:03:22.356 --> 00:03:26.023
فإذا مررنا للأسفل في هذا الدرس
فهنالك مثال على ما قد يكونه المستمع

00:03:26.234 --> 00:03:30.035
وحيث أننا نريد تمرير المستمع كمُدخل
كلما طلبنا تركيز الصوت..

00:03:30.250 --> 00:03:34.593
لنجعل المستمع متغيراً عاماً، لنتمكن
من إعادة استخدامه في كل مرة

00:03:34.916 --> 00:03:37.209
سأباشر بنسخ مقتطف الكود هذا

00:03:37.379 --> 00:03:39.979
وألصقه في نشاط الأرقام
NumbersActivity

00:03:40.912 --> 00:03:44.748
سألصق مقتطف الكود أسفل
كافة المتغيرات العامة الأخرى

00:03:45.618 --> 00:03:47.885
يمكنك تسمية هذا المتغير كيفما أردت

00:03:48.097 --> 00:03:52.330
في حالتي، سأسميه
mOnAudioFocusChangeListener

00:03:53.133 --> 00:03:57.308
نقوم هنا بإنشاء نسخة كائن
جديدة تطبق واجهة المستمع

00:03:57.864 --> 00:04:01.963
وهذا يعني أننا سنحتاج لتخطي
وظيفة onAudioFocusChange

00:04:02.125 --> 00:04:06.029
وهي تلك التي تأخذ باراميتر مدخلات واحد
وهو حالة تركيز الصوت الجديدة

00:04:06.820 --> 00:04:09.351
في هذه الوظيفة
onAudioFocusChange..

00:04:09.730 --> 00:04:13.499
سنضع تعليماتنا حول ما يفترض حدوثه
عندما يستدعي النظام هذه الوظيفة

00:04:14.001 --> 00:04:16.497
لأن حالة تركيز الصوت تغيرت في تطبيقنا

00:04:17.367 --> 00:04:20.198
سيكون من الذكاء هنا أن نكتشف
ما الحالة الجديدة..

00:04:20.263 --> 00:04:22.863
عبر النظر لمتغير تغيير التركيز
الذي مررناه للتو

00:04:23.197 --> 00:04:25.797
سنستخدم هنا جمل if, else الشرطية

00:04:25.867 --> 00:04:28.404
لتفحص ما قيمة متغير (Focus Change)

00:04:28.779 --> 00:04:33.079
تذكر أن معامل (يساوي المزدوج أو ==)
يفحص تساوي الجانبين الأيمن والأيسر

00:04:33.147 --> 00:04:35.114
وإن كانا كذلك، فالتعبير
بإجماله يكون True

00:04:35.374 --> 00:04:37.881
وعندها سننفذ الكود داخل جملة if هذه

00:04:38.233 --> 00:04:39.900
أما إذا كانت قيمة التعبير False

00:04:39.974 --> 00:04:43.974
فإننا نتجاوز المقتطف الأول من الكود
ونقفز إلى جملة if, else

00:04:44.463 --> 00:04:48.332
إذا كان متغير focusChange مساوياً لحالة
AudioFocus_Loss_Transient..

00:04:48.416 --> 00:04:50.982
نكون فقدنا مؤقتاً تركيز الصوت

00:04:51.413 --> 00:04:54.613
هذا يعني قدرتنا على إيقاف المشغل مؤقتاً،
ولذا أضيف هذا الكود هنا

00:04:55.110 --> 00:04:57.077
في وظيفة seekTo في مشغل الوسائط..

00:04:57.157 --> 00:05:00.257
سأضبط موضع البداية
إلى بداية الملف الصوتي

00:05:00.440 --> 00:05:01.782
أي يبدأ في الموضع صفر

00:05:01.846 --> 00:05:04.379
فإذا استعدنا تركيز الصوت مجدداً..

00:05:04.517 --> 00:05:07.511
فمن الأفضل للمستخدم أن يستمع
للكلمة بداية من أول الملف الصوتي

00:05:07.567 --> 00:05:10.967
بدلاً من استماعه لما تبقى منها
خاصة وأن كلماتنا قصيرة

00:05:11.683 --> 00:05:13.428
سأغير اختبار الحالة هنا..

00:05:13.500 --> 00:05:17.788
لأني أريد تطبيق هذا السلوك
عند حالة Loss_Transient أيضاً

00:05:18.172 --> 00:05:19.935
كما سأصلح هذا الخطأ هنا..

00:05:20.047 --> 00:05:23.676
بكتابة
AudioManager.AudioFocus_loss_Transient

00:05:24.123 --> 00:05:27.586
إن كنت تتذكر الاختبار الأخير..
فقد قررنا أن هاتين الحالتين..

00:05:27.763 --> 00:05:29.525
AudioFocus_loss_Transient..

00:05:29.676 --> 00:05:32.011
وAudioFocus_Loss_transient_Can_Duck..

00:05:32.147 --> 00:05:34.021
يمكن معالجتهما بنفس الطريقة

00:05:34.533 --> 00:05:37.233
ليتوقف مشغل الوسائط
مؤقتاً في كلا الحالتين

00:05:37.667 --> 00:05:41.467
لذا يمكننا استخدام الشرطة الرأسية
المزدوجة لتعني (OR) أو (أو المنطقية)

00:05:41.667 --> 00:05:45.000
وهذه أول مرة نستخدمها،
ولذا نتوقع ألا يكون مألوفاً

00:05:45.624 --> 00:05:47.762
باستخدامها، فهذه الجملة تعني..

00:05:47.962 --> 00:05:52.295
إذا كان متغير focusChange يساوي
حالة AudioFocus_Loss_Transient..

00:05:52.533 --> 00:05:54.633
(أو) إذا كان متغير focusChange..

00:05:54.833 --> 00:05:57.833
يساوي حالة
AudioFocus_Loss_Transient_Can_duck

00:05:58.040 --> 00:06:00.274
فإن قيمة هذا التعبير كله ستكون (True)

00:06:00.401 --> 00:06:02.559
ويمكننا تنفيذ مقتطف if البرمجي

00:06:03.000 --> 00:06:06.067
هذا يعني سواء كان التعبير
على يسار رمز (أو)..

00:06:06.567 --> 00:06:08.300
أو التعبير على يمينه..

00:06:08.400 --> 00:06:12.093
تم تقييمه إلى True ستكون قيمة
كامل التعبير True أيضاً

00:06:12.630 --> 00:06:14.502
إن لم تكن تريد استخدام رمز (أو)..

00:06:14.533 --> 00:06:16.800
فيمكنك استخدام else if أخرى..

00:06:16.933 --> 00:06:20.366
لاختبار حالة
AudioFocus_Loss_Transient_Can_Duck

00:06:20.796 --> 00:06:22.996
أما في حالتنا، فدمجناهما في اختبار واحد

00:06:23.067 --> 00:06:27.711
لأن منطق الإيقاف المؤقت وضبط موضع
مشغل الوسائط هو نفسه في الحالتين

00:06:28.005 --> 00:06:31.087
سأضيف تعليقاً ليذكرك
لم اخترنا هذا السلوك

00:06:31.367 --> 00:06:35.000
إذا كان متغير focusChange
لا يساوي أياً من تلك الحالتين..

00:06:35.074 --> 00:06:37.972
فإننا نختبر ما إذا كان يساوي
حالة AudioFocus_Gain

00:06:38.657 --> 00:06:40.257
نعود للجدول من الاختبار السابق

00:06:40.484 --> 00:06:43.930
عندما نحصل على (تركيز الصوت)..
فيمكننا متابعة تشغيل الوسائط

00:06:44.734 --> 00:06:47.569
في واجهة تطبيقات مشغل الوسائط
لا توجد وظيفة (متابعة)

00:06:47.688 --> 00:06:51.327
يمكنك استدعاء وظيفة (البدء)
وسيكمل من حيث توقف

00:06:51.521 --> 00:06:54.266
لذا غير هذا التعليق ليصبح..

00:06:54.818 --> 00:06:57.192
mMediaPlayer.start

00:06:58.439 --> 00:07:01.077
وأضف تعليقاً لوصف هذه الحالة أيضاً

00:07:01.771 --> 00:07:06.145
أخيراً، إذا كان متغير focusChange
لا يساوي أياً من هذه الحالات الثلاث..

00:07:06.314 --> 00:07:08.714
ولكنه يساوي حالة AudioFocus_Loss..

00:07:08.872 --> 00:07:10.672
فسننفذ هذا المقتطف من الكود

00:07:11.207 --> 00:07:13.272
مجدداً نعود للجدول من الاختبار السابق

00:07:13.576 --> 00:07:16.211
قلنا أننا سنتوقف وننظف مشغل الوسائط..

00:07:16.505 --> 00:07:18.674
عندما نفقد (تركيز الصوت) نهائياً

00:07:18.933 --> 00:07:23.070
ولحسن حظنا، فلدينا وظيفة تسمى
(إفلات مشغل الوسائط) لتساعدنا في هذا

00:07:23.873 --> 00:07:25.835
لذا في آخر مقتطف else if

00:07:26.000 --> 00:07:30.271
سأمسح كود العينة، وسأستدعي
وظيفتنا الخاص لإفلات مشغل الوسائط

00:07:30.686 --> 00:07:34.258
وللتناسق، فسأكتب تعليقاً لأصف ما يحدث

00:07:34.801 --> 00:07:36.534
هكذا أنهينا المهمة الثانية

00:07:36.798 --> 00:07:40.853
إنشاء نسخة من OnAudioFocusChangeListener
وتخطي وظيفة الاستدعاء

00:07:41.197 --> 00:07:42.968
كما ينهي هذا المهمة الثالثة

00:07:43.313 --> 00:07:47.113
لأننا غيرنا سلوك مشغل الوسائط
مع تغير حالة (تركيز الصوت)

00:07:47.427 --> 00:07:48.960
يبدو أن لدينا مهمة أخرى

00:07:49.214 --> 00:07:51.914
إفلات تركيز الصوت عندما
ننتهي من تشغيل الصوت

00:07:52.426 --> 00:07:54.917
نعود إلى درس إدارة (تركيز الصوت)..

00:07:55.100 --> 00:07:58.900
حيث يوجد عينة كود
للتخلي عن تركيز الصوت

00:07:59.638 --> 00:08:01.830
هذه الفقرة أعلى مقتطف الكود هنا..

00:08:01.973 --> 00:08:05.310
تذكر أنه عند انتهاءك من تشغيل الصوت،
يجدر بك التخلي عن تركيز الصوت

00:08:05.493 --> 00:08:08.303
وهذا يلغي تسجيل المستمع الذي حدده..

00:08:08.557 --> 00:08:10.052
وهذا باراميتر الإدخال هنا

00:08:10.306 --> 00:08:13.204
لئلا يتم إخطارنا بتغييرات
حالة تركيز الصوت مجدداً

00:08:13.833 --> 00:08:16.566
كما تذكر أنه إذا طلبنا
حالة تركيز انتقالية..

00:08:16.667 --> 00:08:17.667
وهو ما فعلناه

00:08:17.700 --> 00:08:21.300
فهذا سيسمح لأي تطبيق تم مقاطعته
باستكمال تشغيل الوسائط

00:08:21.525 --> 00:08:23.725
لذا لننسخ هذا الكود ونلصقه في تطبيقنا

00:08:24.204 --> 00:08:26.634
أين يجدر بنا وضع الكود
في NumbersActivity؟

00:08:26.833 --> 00:08:29.949
ما أن ينتهي تشغيل الصوت
يجدر بنا التخلي عن التركيز

00:08:30.053 --> 00:08:33.393
لذا يمكننا لصقه في استدعاء
OnCompletion في مشغل الوسائط

00:08:33.539 --> 00:08:36.301
لكن يجب أن ننتبه لدورة حياة النشاط

00:08:36.710 --> 00:08:39.543
وكنا أضفنا كوداً سابقاً
بحيث عند توقف النشاط..

00:08:39.583 --> 00:08:43.050
ويُخفى عن المستخدم أيضًا،
لنتوقف وننظف مشغل الوسائط

00:08:43.367 --> 00:08:46.162
لذا نريد التخلي عن تركيز الصوت
في كلا الموضعين

00:08:46.353 --> 00:08:49.753
وفي كلا الموضعين، يتم استدعاء
وظيفة releaseMediaPlayer بالفعل

00:08:50.105 --> 00:08:54.439
لذا سنتخلى عن تركيز الصوت في
الوظيفة المساعدة.. releaseMediaPlayer

00:08:55.397 --> 00:08:59.131
في نهاية هذه الوظيفة، سأضيف سطراً
للتخلي عن تركيز الصوت

00:08:59.470 --> 00:09:01.234
سأضيفه إلى مقتطف end if

00:09:01.831 --> 00:09:04.165
نعلم أنه من الآمن إفلات التركيز هنا

00:09:04.263 --> 00:09:06.396
لأننا لم نعد نشغل الصوت

00:09:07.416 --> 00:09:09.090
سأغير أسماء المتغيرات..

00:09:09.167 --> 00:09:11.833
من am إلى
mAudioManager

00:09:12.358 --> 00:09:16.540
وسأغير اسم المستمع إلى
mOnAudioFocusChangeListener

00:09:16.783 --> 00:09:19.383
كما سأحدث التعليق في هذا القسم أيضاً

00:09:19.945 --> 00:09:21.841
وهذا ينهي الخطوة الرابعة

00:09:22.138 --> 00:09:25.789
أعلم أنها كانت تعديلات كثيرة في الكود،
ولكننا فرغنا من الخطوات الأربع الآن

00:09:26.054 --> 00:09:27.435
لذا فلتربت على كتفك

00:09:28.668 --> 00:09:31.052
وإذا كان هناك متغيرات أخرى
تحتاج للتحديث..

00:09:31.187 --> 00:09:32.630
لنقم بهذه التغييرات هنا

00:09:33.179 --> 00:09:34.446
والآن لا أخطاء أخرى

00:09:35.033 --> 00:09:37.362
لنتأكد الآن من سلامة التطبيق..
لذا لنشغله

00:09:38.351 --> 00:09:39.917
وها هو التطبيق على جهازي..

00:09:40.009 --> 00:09:42.916
فلنتأكد أنه يعمل ويسلك كما نتوقع منه

00:09:43.369 --> 00:09:44.969
لنذهب إلى نشاط Numbers..

00:09:49.703 --> 00:09:52.370
إذاً فالصوت يتوقف عندما يبدأ آخر

00:09:52.733 --> 00:09:54.815
لكني لن أدرس كافة حالات الاختبار الآن..

00:09:55.074 --> 00:09:57.874
إن أردت اختبار ما إذا كنا ندير مقاطعة
الصوت بشكل سليم..

00:09:57.955 --> 00:10:00.249
عليك تجربة تشغيل الصوت
أثناء إجراء مكالمة

00:10:00.333 --> 00:10:03.300
أو حتى فتح شريط التنبيهات
أثناء محاولة تشغيل الصوت

00:10:03.707 --> 00:10:06.234
مثالياً، ستختبر كل حالة هنا

00:10:06.318 --> 00:10:09.084
في جمل if else لتتأكد أنه
يمكننا إيقاف الصوت مؤقتاً..

00:10:09.162 --> 00:10:12.395
عندما نفقد التركيز،
ومتابعته عندما نحصل عليه

00:10:12.966 --> 00:10:14.701
ما أن يعمل نشاط Numbers..

00:10:14.816 --> 00:10:17.146
سأطبق التغييرات نفسها
في باقي الأنشطة

00:10:17.311 --> 00:10:20.190
وهذا ما تبدو عليه التغييرات
في الكود في نشاط Colors

00:10:20.733 --> 00:10:21.733
نشاط Family..

00:10:22.389 --> 00:10:23.702
ونشاط Phrases

00:10:24.437 --> 00:10:27.242
انظر الملاحظات أدناه لرابط الكود الحل

00:10:28.447 --> 00:10:30.906
رباه، كانت هذه خاصية رئيسية عملاقة

00:10:31.066 --> 00:10:34.149
ومبارك إنهاؤك مهمة برمجة تركيز التطبيق

